/*! gruntDemo 10-03-2017 */
var settingVM=null;avalon.ready(function(){settingVM=avalon.define({$id:"setting",PAGE_DEGREE:0,PAGE_PROJECT:1,data:[],dataStatus:["是","否"],allChecked:!1,currPage:0,pageNo:1,total:1,records:0,init:function(){settingVM.queryPage(1)},changeContent:function(a){settingVM.currPage=a,settingVM.allChecked=!1,settingVM.queryPage(1)},setAuth:function(a){var b=$(a);return b.find(".judge_table th[ac-authCode],td[ac-authCode],a[ac-authCode]").authController(),b.html()},queryPage:function(a){a>settingVM.total||a<1||(settingVM.allChecked=!1,settingVM.pageNo=a,settingVM.currPage==settingVM.PAGE_DEGREE?settingVM.queryList("/grow/honor/degree/paging"):settingVM.currPage==settingVM.PAGE_PROJECT&&settingVM.queryList("/grow/honor/project/paging"))},queryList:function(a){openLoading(),$.ajaxFun({url:a,type:"post",dataType:"json",data:{pageNo:settingVM.pageNo},onSuccess:function(a){avalon.log(a),isSuccess(a)&&(settingVM.pageNo=a.bizData.page,settingVM.records=a.bizData.records,settingVM.total=a.bizData.total,avalon.each(a.bizData.rows,function(a,b){b.checked=!1}),settingVM.data=[],settingVM.data=a.bizData.rows,0==settingVM.data.length?$("#noDataTip_honor_setting").show():$("#noDataTip_honor_setting").hide()),closeLoading()}})},checkAll:function(){if(settingVM.currPage==settingVM.PAGE_DEGREE){var a;settingVM.data.forEach(function(b){(a=1==b.type)&&(b.checked=settingVM.allChecked)})}else settingVM.currPage==settingVM.PAGE_PROJECT&&settingVM.data.forEach(function(a){a.checked=settingVM.allChecked})},checkOne:function(){if(this.checked)if(settingVM.currPage==settingVM.PAGE_DEGREE){settingVM.allChecked=!0;for(var a,b=0,c=settingVM.data.length;b<c;b++)if(a=settingVM.data[b],1==a.type&&!a.checked){settingVM.allChecked=!1;break}}else settingVM.currPage==settingVM.PAGE_PROJECT&&(settingVM.allChecked=settingVM.data.every(function(a){return a.checked}));else settingVM.allChecked=!1},popDegreeAdd:function(){layerOpen("./degree/degree.html","新增荣誉级别",{},"550px","auto",null,function(){settingVM.queryPage(1)},function(){avalon.scan($("#setting_degree")[0],settingDegreeVM),settingDegreeVM.init()})},popDegreeEdit:function(a){layerOpen("./degree/degree.html","编辑荣誉级别",{id:a},"550px","auto",null,null,function(){avalon.scan($("#setting_degree")[0],settingDegreeVM),settingDegreeVM.init()})},popProjectAdd:function(){layerOpen("./project/project.html","新增荣誉项目",{},"550px","auto",null,null,function(){avalon.scan($("#setting_project")[0],settingProjectVM),settingProjectVM.init()})},popProjectEdit:function(a){layerOpen("./project/project.html","编辑荣誉项目",{id:a},"550px","auto",null,null,function(){avalon.scan($("#setting_project")[0],settingProjectVM),settingProjectVM.init()})},batchDeleteDegrees:function(){var a=settingVM.packingParam();if(0==a.delIds.length)return void layer.alert("请选择删除项！");settingVM.doBatchDelete({checkURL:"/grow/honor/degree/batchCheckDeletableDegree",checkItem:"荣誉项目",deleteURL:"/grow/honor/degree/batchDelete"},a)},batchDeleteProjects:function(){var a=settingVM.packingParam();if(0==a.delIds.length)return void layer.alert("请选择删除项！");settingVM.doBatchDelete({checkURL:"/grow/honor/project/batchCheckDeletableProject",checkItem:"荣誉记录",deleteURL:"/grow/honor/project/batchDelete"},a)},packingParam:function(){var a=[],b=[];return settingVM.data.forEach(function(c){c.checked&&(b.push(c.id),a.push(c.code))}),{delCodes:a,delIds:b}},doBatchDelete:function(a,b){layer.confirm("确定要删除选中的"+b.delCodes.length+"项？",function(){openLoading(),$.ajaxFun({url:a.checkURL,type:"post",dataType:"json",data:{codesJSONStr:JSON.stringify(b.delCodes)},onSuccess:function(c){avalon.log(c),isSuccess(c)?c.bizData.length>0?layer.alert("待删除项中第"+c.bizData+"条数据已关联"+a.checkItem+"，无法删除！"):$.ajaxFun({url:a.deleteURL,type:"post",dataType:"json",data:{idsJSONStr:JSON.stringify(b.delIds)},onSuccess:function(a){settingVM.afterDelete(a)}}):layer.alert(c.msg),closeLoading()}}),layerClose()})},deleteDegree:function(a,b){settingVM.doDelete({checkURL:"/grow/honor/degree/checkDeletableDegree",alertMsg:"该级别下已关联荣誉项目，无法删除！",deleteURL:"/grow/honor/degree/delete"},{id:a,code:b})},deleteProject:function(a,b){settingVM.doDelete({checkURL:"/grow/honor/project/checkDeletableProject",alertMsg:"该项目下已关联荣誉记录，无法删除！",deleteURL:"/grow/honor/project/delete"},{id:a,code:b})},doDelete:function(a,b){layer.confirm("确定要删除选中项？",function(){openLoading(),$.ajaxFun({url:a.checkURL,type:"post",dataType:"json",data:{code:b.code},onSuccess:function(c){avalon.log(c),isSuccess(c)?c.bizData?layer.alert(a.alertMsg):$.ajaxFun({url:a.deleteURL,type:"post",dataType:"json",data:{id:b.id},onSuccess:function(a){settingVM.afterDelete(a)}}):layer.alert(c.msg),closeLoading()}}),layerClose()})},afterDelete:function(a){if(avalon.log(a),!isSuccess(a))return void layer.alert(a.msg);a.bizData.success?layer.alert(a.bizData.msg,function(a){layer.close(a),settingVM.queryPage(1)}):layer.alert(a.bizData.msg)},goBack:function(){window.location.href="listHonorAdmin.html"}}),avalon.scan($("#setting")[0],settingVM),settingVM.init()});